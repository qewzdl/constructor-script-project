{{- define "archive-tree-list" -}}
<ul class="archive-tree__list">
    {{- range . }}
    {{- $dirName := trim (default "" .Name) -}}
    {{- $dirPath := trim (default "" .Path) -}}
    <li class="archive-tree__item">
        <article class="archive-tree__entry">
            <h3 class="archive-tree__entry-title">
                <a class="archive-tree__entry-link" href="{{ if $dirPath }}/archive/{{ $dirPath }}{{ else }}#{{ end }}">
                    {{- if $dirName -}}
                    {{ $dirName }}
                    {{- else if $dirPath -}}
                    {{ $dirPath }}
                    {{- else -}}
                    Untitled directory
                    {{- end -}}
                </a>
            </h3>
            {{- with .Files }}
            <ul class="archive-tree__files">
                {{- range . }}
                {{- $fileName := trim (default "" .Name) -}}
                {{- $filePath := trim (default "" .Path) -}}
                <li class="archive-tree__file">
                    <a class="archive-tree__file-link" href="{{ if $filePath }}/archive/files/{{ $filePath }}{{ else }}#{{ end }}">
                        {{- if $fileName -}}
                        {{ $fileName }}
                        {{- else if $filePath -}}
                        {{ $filePath }}
                        {{- else -}}
                        View file
                        {{- end -}}
                    </a>
                    {{- with trim .FileType }}
                    <span class="archive-tree__file-meta">{{ . }}</span>
                    {{- else }}
                    {{- with trim .MimeType }}
                    <span class="archive-tree__file-meta">{{ . }}</span>
                    {{- end }}
                    {{- end }}
                </li>
                {{- end }}
            </ul>
            {{- end }}
        </article>
        {{- if .Children }}
        {{- template "archive-tree-list" .Children -}}
        {{- end }}
    </li>
    {{- end }}
</ul>
{{- end -}}

{{- $pageTitle := default "Resource archive" .Title -}}
{{- $pageDescription := trim (default "Browse shared documents and downloadable files from a single archive." .Description) -}}

<section class="archive" data-archive="overview">
    <div class="archive__container">
        <header class="archive__header">
            <h1 class="archive__title">{{ $pageTitle }}</h1>
            <p class="archive__description">{{ $pageDescription }}</p>
        </header>
        <div class="archive__body">
            <section class="archive-tree" aria-labelledby="archive-tree-title">
                <div>
                    <h2 id="archive-tree-title" class="archive-tree__title">Browse available resources</h2>
                    <p class="archive-tree__hint">
                        Explore the directory structure to locate handbooks, documents, and media shared with the community.
                    </p>
                </div>
                {{- if .Directories }}
                {{- template "archive-tree-list" .Directories -}}
                {{- else }}
                <p class="archive-tree__empty">The archive is currently empty. Check back soon for new resources.</p>
                {{- end }}
            </section>
        </div>
    </div>
</section>
