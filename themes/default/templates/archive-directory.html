{{- $directory := .Directory -}}
{{- $children := .Children -}}
{{- $files := .Files -}}
{{- $breadcrumbs := .Breadcrumbs -}}

<section class="archive-directory" data-archive="directory">
    <div class="archive-directory__container">
        <nav class="archive-breadcrumbs" aria-label="Breadcrumb">
            <ol class="archive-breadcrumbs__list">
                <li class="archive-breadcrumbs__item">
                    <a class="archive-breadcrumbs__link" href="/archive">Archive</a>
                </li>
                {{- $crumbCount := len $breadcrumbs -}}
                {{- if gt $crumbCount 0 -}}
                {{- $lastIndex := sub $crumbCount 1 -}}
                {{- range $index, $crumb := $breadcrumbs -}}
                {{- $crumbName := trim (default "" $crumb.Name) -}}
                {{- $crumbPath := trim (default "" $crumb.Path) -}}
                <li class="archive-breadcrumbs__item">
                    <span aria-hidden="true">â€º</span>
                    {{- if eq $index $lastIndex -}}
                    <span aria-current="page">
                        {{- if $crumbName -}}
                        {{ $crumbName }}
                        {{- else -}}
                        {{- if $crumbPath -}}
                        {{ $crumbPath }}
                        {{- else -}}
                        Current directory
                        {{- end -}}
                        {{- end -}}
                    </span>
                    {{- else -}}
                    {{- if $crumbPath -}}
                    <a class="archive-breadcrumbs__link" href="/archive/{{ $crumbPath }}">
                        {{- if $crumbName -}}
                        {{ $crumbName }}
                        {{- else -}}
                        {{ $crumbPath }}
                        {{- end -}}
                    </a>
                    {{- else -}}
                    <span>
                        {{- if $crumbName -}}
                        {{ $crumbName }}
                        {{- else -}}
                        Directory
                        {{- end -}}
                    </span>
                    {{- end -}}
                    {{- end -}}
                </li>
                {{- end -}}
                {{- end -}}
            </ol>
        </nav>

        <header class="archive-directory__header">
            <h1 class="archive-directory__title">{{ trim (default "Archive directory" $directory.Name) }}</h1>
        </header>

        {{- $hasFiles := gt (len $files) 0 -}}
        {{- $hasChildren := gt (len $children) 0 -}}
        {{- if or $hasFiles $hasChildren }}
        <div class="archive-directory__sections">
            {{- if $hasFiles }}
            <section class="archive-directory__panel" aria-labelledby="archive-directory-files-title">
                <div>
                    <h2 id="archive-directory-files-title" class="archive-directory__panel-title">Files</h2>
                    <p class="archive-tree__hint">
                        View the documents stored in this directory. Download originals or open the detail view for a dedicated preview.
                    </p>
                </div>
                <ul class="archive-directory__items">
                    {{- range $files }}
                    {{- $fileName := trim (default "" .Name) -}}
                    {{- $filePath := trim (default "" .Path) -}}
                    <li class="archive-directory__item">
                        <h3 class="archive-directory__item-title">
                            {{- if $fileName -}}
                            {{ $fileName }}
                            {{- else -}}
                            {{- if $filePath -}}
                            {{ $filePath }}
                            {{- else -}}
                            Archive file
                            {{- end -}}
                            {{- end -}}
                        </h3>
                        <div class="archive-directory__file-actions">
                            {{- if $filePath }}
                            <a class="archive-button archive-button--ghost" href="/archive/files/{{ $filePath }}">View details</a>
                            {{- end }}
                            {{- with trim (default "" .FileURL) }}
                            <a class="archive-button" href="{{ . }}" target="_blank" rel="noopener">Download</a>
                            {{- end }}
                        </div>
                    </li>
                    {{- end }}
                </ul>
            </section>
            {{- end }}

            {{- if $hasChildren }}
            <section class="archive-directory__panel" aria-labelledby="archive-directory-children-title">
                <div>
                    <h2 id="archive-directory-children-title" class="archive-directory__panel-title">Subdirectories</h2>
                    <p class="archive-tree__hint">
                        Navigate into nested directories to explore additional collections of files and resources.
                    </p>
                </div>
                <ul class="archive-directory__items archive-directory__items--directories">
                    {{- range $children }}
                    {{- $childName := trim (default "" .Name) -}}
                    {{- $childPath := trim (default "" .Path) -}}
                    <li class="archive-directory__item archive-directory__item--directory archive-tree__item">
                        <article class="archive-tree__entry">
                            <a class="archive-tree__entry-link" href="{{- if $childPath -}}/archive/{{ $childPath }}{{- else -}}#{{- end }}">
                                <svg class="entry-link__icon" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><g stroke-width="0"></g><g stroke-linecap="round" stroke-linejoin="round"></g><g><title>ionicons-v5-n</title><path d="M64,192V120a40,40,0,0,1,40-40h75.89a40,40,0,0,1,22.19,6.72l27.84,18.56A40,40,0,0,0,252.11,112H408a40,40,0,0,1,40,40v40" style="fill:none;stroke-linecap:round;stroke-linejoin:round;stroke-width:32px"></path><path d="M479.9,226.55,463.68,392a40,40,0,0,1-39.93,40H88.25a40,40,0,0,1-39.93-40L32.1,226.55A32,32,0,0,1,64,192h384.1A32,32,0,0,1,479.9,226.55Z" style="fill:none;stroke-linecap:round;stroke-linejoin:round;stroke-width:32px"></path></g></svg>
                                <span class="archive-directory__item-title">
                                    {{- if $childName -}}
                                    {{ $childName }}
                                    {{- else -}}
                                    {{- if $childPath -}}
                                    {{ $childPath }}
                                    {{- else -}}
                                    Subdirectory
                                    {{- end -}}
                                    {{- end -}}
                                </span>
                            </a>
                        </article>
                    </li>
                    {{- end }}
                </ul>
            </section>
            {{- end }}
        </div>
        {{- end }}
    </div>
</section>
