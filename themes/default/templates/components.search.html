{{ define "components/search" }}
    {{ $id := default "search" .ID }}
    {{ $heading := default "h2" .Heading }}
    {{ $title := default "Search" .Title }}
    {{ $description := .Description }}
    {{ $action := default "/search" .Action }}
    {{ $method := default "get" .Method }}
    {{ $query := default "" .Query }}
    {{ $searchType := default "all" .SearchType }}
    {{ $placeholder := default "Start typing to search posts" .Placeholder }}
    {{ $submitLabel := default "Search" .SubmitLabel }}
    {{ $filterLabel := default "Filter by" .FilterLabel }}
    {{ $showFilters := default true .ShowFilters }}
    {{ $showResults := default false .ShowResults }}
    {{ $hasQuery := default false .HasQuery }}
    {{ $hint := default "Use the search form above to explore the knowledge base." .Hint }}
    {{ $result := .Result }}
    <section class="search" aria-labelledby="{{ $id }}-title">
        <header class="search__header">
            {{ if eq $heading "h1" }}
            <h1 id="{{ $id }}-title" class="search__title">{{ $title }}</h1>
            {{ else if eq $heading "h3" }}
            <h3 id="{{ $id }}-title" class="search__title">{{ $title }}</h3>
            {{ else if eq $heading "h4" }}
            <h4 id="{{ $id }}-title" class="search__title">{{ $title }}</h4>
            {{ else if eq $heading "h5" }}
            <h5 id="{{ $id }}-title" class="search__title">{{ $title }}</h5>
            {{ else if eq $heading "h6" }}
            <h6 id="{{ $id }}-title" class="search__title">{{ $title }}</h6>
            {{ else }}
            <h2 id="{{ $id }}-title" class="search__title">{{ $title }}</h2>
            {{ end }}
            {{ if $description }}
            <p class="search__description">{{ $description }}</p>
            {{ end }}
        </header>

        <form class="search__form" action="{{ $action }}" method="{{ $method }}" role="search" aria-label="Site search">
            <div class="search__fields">
                <div class="search__input-group">
                    <label class="search__label" for="{{ $id }}-query">Search query</label>
                    <input
                        id="{{ $id }}-query"
                        class="search__input"
                        type="search"
                        name="q"
                        value="{{ $query }}"
                        placeholder="{{ $placeholder }}"
                        required
                    />
                </div>

                {{ if $showFilters }}
                <div class="search__input-group">
                    <label class="search__label" id="{{ $id }}-type-label" for="{{ $id }}-type-trigger">{{ $filterLabel }}</label>
                    <div class="search__custom-select" data-custom-select>
                        <input
                            type="hidden"
                            name="type"
                            value="{{ $searchType }}"
                            data-custom-select-input
                        />
                        <button
                            id="{{ $id }}-type-trigger"
                            class="search__custom-trigger"
                            type="button"
                            aria-haspopup="listbox"
                            aria-expanded="false"
                            aria-labelledby="{{ $id }}-type-label {{ $id }}-type-trigger"
                            aria-controls="{{ $id }}-type-options"
                            data-custom-select-trigger
                        >
                            <span data-custom-select-label>
                                {{- if eq $searchType "title" -}}Title{{- else if eq $searchType "content" -}}Content{{- else if eq $searchType "tag" -}}Tag{{- else if eq $searchType "author" -}}Author{{- else -}}Title &amp; content{{- end -}}
                            </span>
                            <span class="search__custom-icon" aria-hidden="true"></span>
                        </button>
                        <ul
                            id="{{ $id }}-type-options"
                            class="search__custom-options"
                            role="listbox"
                            aria-labelledby="{{ $id }}-type-label"
                            tabindex="-1"
                            hidden
                            data-custom-select-list
                        >
                            <li
                                id="{{ $id }}-type-option-all"
                                class="search__custom-option{{ if or (eq $searchType "") (eq $searchType "all") }} search__custom-option--selected{{ end }}"
                                role="option"
                                data-value="all"
                                aria-selected="{{ if or (eq $searchType "") (eq $searchType "all") }}true{{ else }}false{{ end }}"
                                data-custom-select-option
                            >
                                Title &amp; content
                            </li>
                            <li
                                id="{{ $id }}-type-option-title"
                                class="search__custom-option{{ if eq $searchType "title" }} search__custom-option--selected{{ end }}"
                                role="option"
                                data-value="title"
                                aria-selected="{{ if eq $searchType "title" }}true{{ else }}false{{ end }}"
                                data-custom-select-option
                            >
                                Title
                            </li>
                            <li
                                id="{{ $id }}-type-option-content"
                                class="search__custom-option{{ if eq $searchType "content" }} search__custom-option--selected{{ end }}"
                                role="option"
                                data-value="content"
                                aria-selected="{{ if eq $searchType "content" }}true{{ else }}false{{ end }}"
                                data-custom-select-option
                            >
                                Content
                            </li>
                            <li
                                id="{{ $id }}-type-option-tag"
                                class="search__custom-option{{ if eq $searchType "tag" }} search__custom-option--selected{{ end }}"
                                role="option"
                                data-value="tag"
                                aria-selected="{{ if eq $searchType "tag" }}true{{ else }}false{{ end }}"
                                data-custom-select-option
                            >
                                Tag
                            </li>
                            <li
                                id="{{ $id }}-type-option-author"
                                class="search__custom-option{{ if eq $searchType "author" }} search__custom-option--selected{{ end }}"
                                role="option"
                                data-value="author"
                                aria-selected="{{ if eq $searchType "author" }}true{{ else }}false{{ end }}"
                                data-custom-select-option
                            >
                                Author
                            </li>
                        </ul>
                    </div>
                </div>
                {{ else }}
                <input type="hidden" name="type" value="{{ $searchType }}" />
                {{ end }}
            </div>

            <button type="submit" class="search__submit">{{ $submitLabel }}</button>
        </form>

        {{ if and $showResults $hasQuery }}
        <section class="search__results" aria-live="polite" aria-busy="false">
            {{ with $result }}
                {{ if gt (len .Posts) 0 }}
                <p class="search__meta">
                    Found {{ if gt .Total 0 }}{{ .Total }}{{ else }}{{ len .Posts }}{{ end }} {{ if eq (len .Posts) 1 }}result{{ else }}results{{ end }} for
                    <strong>&ldquo;{{ .Query }}&rdquo;</strong>
                </p>
                <div class="search__posts">
                    {{ range .Posts }}
                    {{ $authorName := or (and .Author .Author.Username) "" }}
                    {{ template "components/post-card" (dict
                        "Post" .
                        "WrapperClass" "post-card search__post"
                        "HideViews" true
                        "ShowAuthor" (ne $authorName "")
                        "AuthorName" $authorName
                    ) }}
                    {{ end }}
                </div>
                {{ else }}
                <p class="search__empty">
                    We couldn&rsquo;t find anything for <strong>&ldquo;{{ .Query }}&rdquo;</strong>. Try another keyword or change the filter.
                </p>
                {{ end }}
            {{ end }}
        </section>
        {{ else if and (not $hasQuery) $hint }}
        <p class="search__hint">{{ $hint }}</p>
        {{ else if and $hasQuery $result }}
            {{ if eq $result.Total 0 }}
            <section class="search__results" aria-live="polite" aria-busy="false">
                <p class="search__empty">
                    We couldn&rsquo;t find anything for <strong>&ldquo;{{ $result.Query }}&rdquo;</strong>. Try another keyword or change the filter.
                </p>
            </section>
            {{ end }}
        {{ end }}
    </section>
{{ end }}
