<section class="profile" role="region" aria-labelledby="profile-title" data-page="profile">
    <section class="profile__container" aria-labelledby="profile-title">
        <header class="profile__header">
            <h1 id="profile-title" class="profile__title">Personal profile</h1>
            <p class="profile__subtitle">
                Update your contact information and keep your account secure across every device.
            </p>
        </header>

        <div class="profile__grid">
            <section class="profile-card" aria-labelledby="profile-details-title">
                <header class="profile-card__header">
                    <h2 id="profile-details-title" class="profile-card__title">Account details</h2>
                    <p class="profile-card__description">
                        The information below appears in comments and author bylines.
                    </p>
                </header>

                <div class="profile__alert" id="profile-details-alert" role="alert" hidden></div>

                <form
                    id="profile-form"
                    class="profile-form"
                    method="post"
                    data-action="{{ .ProfileAction }}"
                    novalidate
                >
                    <div class="form-grid">
                        <div class="form-field">
                            <label class="form-field__label" for="profile-username">Username</label>
                            <input
                                id="profile-username"
                                name="username"
                                type="text"
                                class="form-field__input"
                                placeholder="Display name"
                                autocomplete="username"
                                value="{{ if .CurrentUser }}{{ .CurrentUser.Username }}{{ end }}"
                                required
                            />
                        </div>
                        <div class="form-field">
                            <label class="form-field__label" for="profile-email">Email</label>
                            <input
                                id="profile-email"
                                name="email"
                                type="email"
                                class="form-field__input"
                                placeholder="name@example.com"
                                autocomplete="email"
                                value="{{ if .CurrentUser }}{{ .CurrentUser.Email }}{{ end }}"
                                required
                            />
                        </div>
                    </div>

                    <div class="form-field">
                        <label class="form-field__label" for="profile-role">Role</label>
                        <input
                            id="profile-role"
                            name="role"
                            type="text"
                            class="form-field__input"
                            value="{{ if .CurrentUser }}{{ .CurrentUser.Role }}{{ else }}user{{ end }}"
                            readonly
                            aria-readonly="true"
                        />
                    </div>

                    <button type="submit" class="button button--primary">Save changes</button>
                </form>
            </section>

            <section class="profile-card" aria-labelledby="security-title">
                <header class="profile-card__header">
                    <h2 id="security-title" class="profile-card__title">Security</h2>
                    <p class="profile-card__description">
                        Change your password regularly and review connected devices.
                    </p>
                </header>

                <div class="profile__alert" id="profile-password-alert" role="alert" hidden></div>

                <form
                    id="password-form"
                    class="profile-form"
                    method="post"
                    data-action="{{ .PasswordChangeAction }}"
                    novalidate
                >
                    <input
                        type="text"
                        name="username"
                        value="{{ if .CurrentUser }}{{ .CurrentUser.Username }}{{ end }}"
                        autocomplete="username"
                        hidden
                    />
                    <div class="form-field">
                        <label class="form-field__label" for="current-password">Current password</label>
                        <input
                            id="current-password"
                            name="old_password"
                            type="password"
                            class="form-field__input"
                            autocomplete="current-password"
                            required
                        />
                    </div>

                    <div class="form-grid">
                        <div class="form-field">
                            <label class="form-field__label" for="new-password">New password</label>
                            <input
                                id="new-password"
                                name="new_password"
                                type="password"
                                class="form-field__input"
                                autocomplete="new-password"
                                required
                            />
                        </div>
                        <div class="form-field">
                            <label class="form-field__label" for="confirm-password">Confirm password</label>
                            <input
                                id="confirm-password"
                                name="confirm_password"
                                type="password"
                                class="form-field__input"
                                autocomplete="new-password"
                                required
                            />
                        </div>
                    </div>

                    <button type="submit" class="button button--secondary">Update password</button>
                </form>
            </section>
        </div>

        <section class="profile-card profile-card--courses" aria-labelledby="profile-courses-title">
            <header class="profile-card__header">
                <h2 id="profile-courses-title" class="profile-card__title">Courses</h2>
                <p class="profile-card__description">
                    Review the learning packages currently available to your account.
                </p>
            </header>

            <div class="profile-courses" id="profile-courses">
                {{ $hasCourses := gt (len .UserCourses) 0 }}
                <p class="profile-courses__empty" {{ if $hasCourses }}hidden{{ end }}>
                    You don't have any courses yet.
                </p>
                <ul class="profile-courses__list courses-list" {{ if not $hasCourses }}hidden{{ end }}>
                    {{ range .UserCourses }}
                        {{ $pkg := .Package }}
                        {{ $access := .Access }}
                        <li class="profile-courses__item">
                            <article class="profile-course post-card">
                                {{ with $pkg.ImageURL }}
                                    <figure class="profile-course__media post-card__figure">
                                        <img
                                            src="{{ asset . }}"
                                            alt="{{ default "Course cover" $pkg.Title }}"
                                            loading="lazy"
                                            class="profile-course__image post-card__image"
                                        />
                                    </figure>
                                {{ end }}
                                <div class="profile-course__content post-card__content">
                                    <h3 class="profile-course__title post-card__title">{{ default "Untitled course" $pkg.Title }}</h3>
                                    {{ if $pkg.Description }}
                                        <p class="profile-course__description post-card__description">{{ $pkg.Description }}</p>
                                    {{ end }}
                                    <div class="profile-course__meta post-card__meta">
                                        <span class="profile-course__meta-item">
                                            Granted
                                            <time datetime="{{ $access.CreatedAt.Format "2006-01-02T15:04:05Z07:00" }}">
                                                {{ formatDate $access.CreatedAt "medium" }}
                                            </time>
                                        </span>
                                        {{ with $access.ExpiresAt }}
                                            <span class="profile-course__meta-item">
                                                Expires
                                                <time datetime="{{ .Format "2006-01-02T15:04:05Z07:00" }}">
                                                    {{ formatDate . "medium" }}
                                                </time>
                                            </span>
                                        {{ else }}
                                            <span class="profile-course__meta-item">No expiration</span>
                                        {{ end }}
                                    </div>
                                    {{ if $pkg.ID }}
                                        <div class="profile-course__actions">
                                            <a class="button button--primary profile-course__action" href="/courses/{{ $pkg.ID }}">
                                                Open course
                                            </a>
                                        </div>
                                    {{ end }}
                                </div>
                            </article>
                        </li>
                    {{ end }}
                </ul>
            </div>
        </section>
    </section>
</section>